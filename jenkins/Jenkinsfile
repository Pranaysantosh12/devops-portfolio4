pipeline {
    agent any

    environment {
        PROJECT_NAME = 'devops-portfolio'
        K8S_MANIFEST = 'k8s-deployment.yaml'
    }

    stages {
        stage('Step 1: Clone Repository') {
            steps {
                echo 'ðŸ“¥ Cloning GitHub repo...'
                git url: 'https://github.com/Pranaysantosh12/devops-portfolio4.git',
                    branch: 'master',
                    credentialsId: 'jenkins-tokenv2'
            }
        }

        stage('Step 2: Confirm Files') {
            steps {
                echo 'ðŸ“‚ Showing project file structure...'
                dir('.') {
                    script {
                        def files = []
                        new File(".").eachFile { file ->
                            files << file.name
                        }
                        echo "Files in project:\n" + files.join('\n')
                    }
                }
            }
        }

        stage('Step 3: Simulate Docker Build') {
            steps {
                echo 'ðŸ³ Docker simulation (Docker not available)...'
                echo "Simulated build of image: ${PROJECT_NAME}:latest"
            }
        }

        stage('Step 4: Simulate Kubernetes Deployment') {
            steps {
                echo 'ðŸ“¦ Simulating kubectl apply using manifest...'
                echo "Would apply file: ${K8S_MANIFEST}"
                echo 'âœ… Simulated: kubectl apply -f k8s-deployment.yaml'
            }
        }

        stage('Step 5: Archive Artifacts') {
            steps {
                echo 'ðŸ—ƒï¸ Archiving project files for download/view...'
                archiveArtifacts artifacts: '*.html', fingerprint: true
            }
        }

        stage('Step 6: Confirmation') {
            steps {
                echo 'âœ… Pipeline completed. Open "index.html" from artifacts tab.'
            }
        }
    }
}
