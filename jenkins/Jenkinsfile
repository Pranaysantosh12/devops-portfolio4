pipeline {
    agent any

    environment {
        IMAGE_NAME = 'devops-portfolio'
        TAG = 'v1'
        DEPLOYMENT_FILE = 'k8s-deployment.yaml'
    }

    stages {
        stage('Step 1: Clone Repository') {
            steps {
                echo 'Cloning GitHub repo...'
                git(
                    url: 'https://github.com/Pranaysantosh12/devops-portfolio4.git',
                    branch: 'master',
                    credentialsId: 'jenkins-tokenv2'
                )
            }
        }

        stage('Step 2: Confirm Project Files') {
            steps {
                echo 'Files cloned:'
                script {
                    def files = new File('.').list()
                    files.each { file -> echo "  - ${file}" }
                }
            }
        }

        stage('Step 3: Build Image (simulate without Docker Desktop)') {
            steps {
                echo '‚ö†Ô∏è Docker Desktop not available ‚Äî skipping actual build'
                echo 'üõ†Ô∏è Simulating: docker build -t ${IMAGE_NAME}:${TAG} .'
            }
        }

        stage('Step 4: Kubernetes Deployment') {
            steps {
                echo 'Deploying to Kubernetes using the YAML file...'
                script {
                    try {
                        def status = "kubectl apply -f ${DEPLOYMENT_FILE}".execute().text
                        echo status
                    } catch (Exception e) {
                        error("‚ùå Kubernetes deployment failed: ${e.message}")
                    }
                }
            }
        }

        stage('Step 5: Confirmation') {
            steps {
                echo '‚úÖ Jenkins pipeline executed with visible stages and Kubernetes deployment!'
            }
        }
    }
}
   
                  
